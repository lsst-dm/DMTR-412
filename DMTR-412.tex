% generated from JIRA project LVV
% using template at /usr/share/miniconda/envs/docsteady-env/lib/python3.12/site-packages/docsteady/templates/tpr.latex.jinja2.
% using docsteady version 0.0.0
% Please do not edit -- update information in Jira instead
\documentclass[DM,lsstdraft,STR,toc]{lsstdoc}
\usepackage{geometry}
\usepackage{longtable,booktabs}
\usepackage{enumitem}
\usepackage{arydshln}
\usepackage{attachfile}
\usepackage{array}
\usepackage{dashrule}
\usepackage{pdfpages}

\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

\input{meta.tex}

\newcommand{\attachmentsUrl}{https://github.com/\gitorg/\lsstDocType-\lsstDocNum/blob/\gitref/attachments}
\providecommand{\tightlist}{
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\setcounter{tocdepth}{4}

\providecommand{\ul}[1]{\textbf{#1}}

\begin{document}

\def\milestoneName{DM Acceptance Testing, Operations Rehearsal \#2}
\def\milestoneId{}
\def\product{Acceptance}

\setDocCompact{true}

\title{LVV-P72: DM Acceptance Testing, Operations Rehearsal \#2 Test Plan and Report}
\setDocRef{\lsstDocType-\lsstDocNum}
\date{ 2024-07-02 }
\author{ Leanne Guy }

\input{history_and_info.tex}


\setDocAbstract{
This is the test plan and report for
\textbf{ DM Acceptance Testing, Operations Rehearsal \#2},
an LSST milestone pertaining to the Data Management Subsystem.\\
This document is based on content automatically extracted from the Jira test database on \docDate.
The most recent change to the document repository was on \vcsDate.
}


\maketitle

\section{Introduction}
\label{sect:intro}


\subsection{Objectives}
\label{sect:objectives}

 This Acceptance Test campaign aims to verify a small number of~
\href{https://lse-61.lsst.io/}{DMSR} (\citeds{LSE-61}) requirements related to
the LSST Science Pipelines. It will be executed in conjunction with
Operations Rehearsal \#2. This Test Plan aims to demonstrate that the
included requirements have been met by the activities carried out during
the Operations Rehearsal, and to thus fully verify their completion and
readiness for LSST Operations.



\subsection{System Overview}
\label{sect:systemoverview}

 The tests to be executed are intended to verify that the DM system
satisfies a subset of the requirements outlined in the Data Management
System Requirements (DMSR;~ \href{https://lse-61.lsst.io/}{LSE-61} ).
This subset of requirements is related to pipeline algorithms, network
and observing facility infrastructure, and some basic camera and data
backbone functionalities. Additional DMSR requirements will be verified
in later Acceptance Test Campaigns.\\
\strut \\
The tests will be performed using...\\
\strut \\
Planning for the Operations Rehearsal is being tracked at~
\href{https://confluence.lsstcorp.org/display/DM/Operations+Rehearsal+\%232}{this
Confluence page} .\\
\strut \\
\textbf{Applicable Documents:}\\
\strut \\
\citeds{LSE-61} Data Management System Requirements\\
\citeds{LDM-503} Data Management Test Plan\\
\citeds{LDM-639} LSST Data Management Acceptance Test Specification (issue 2.1)\\
\citeds{LDM-643} Proposed DM Ops Rehearsals (Chapter 3 in particular)\\
\citeds{LDM-732} Rubin Observatory Network Verification Baseline


\subsection{Document Overview}
\label{sect:docoverview}

This document was generated from Jira, obtaining the relevant information from the
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P72}{LVV-P72}
~Jira Test Plan and related Test Cycles (
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCycle/LVV-C159}{LVV-C159}
).

Section \ref{sect:intro} provides an overview of the test campaign, the system under test (\product{}),
the applicable documentation, and explains how this document is organized.
Section \ref{sect:testplan} provides additional information about the test plan, like for example the configuration
used for this test or related documentation.
Section \ref{sect:personnel} describes the necessary roles and lists the individuals assigned to them.

Section \ref{sect:overview} provides a summary of the test results, including an overview in Table \ref{table:summary},
an overall assessment statement and suggestions for possible improvements.
Section \ref{sect:detailedtestresults} provides detailed results for each step in each test case.

The current status of test plan \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P72}{LVV-P72} in Jira is \textbf{ Completed }.

\subsection{References}
\label{sect:references}
\renewcommand{\refname}{}
\bibliography{lsst,refs,books,refs_ads,local}


\newpage
\section{Test Plan Details}
\label{sect:testplan}


\subsection{Data Collection}

  Observing is not required for this test campaign.

\subsection{Verification Environment}
\label{sect:hwconf}
  Tests that require code and/or data analysis will use the
"lsst-lsp-stable" instance of the Rubin Observatory/LSST Science
Platform (LSP), hosted at the LDF, and the "lsst-dev" development
cluster at NCSA.




\subsection{Related Documentation}


No additional documentation provided.


\subsection{PMCS Activity}

Primavera milestones related to the test campaign:
\begin{itemize}
\item None
\end{itemize}


\newpage
\section{Personnel}
\label{sect:personnel}

The personnel involved in the test campaign is shown in the following table.

{\small
\begin{longtable}{p{3cm}p{3cm}p{3cm}p{6cm}}
\hline
\multicolumn{2}{r}{T. Plan \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P72}{LVV-P72} owner:} &
\multicolumn{2}{l}{\textbf{ Leanne Guy } }\\\hline
\multicolumn{2}{r}{T. Cycle \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCycle/LVV-C159}{LVV-C159} owner:} &
\multicolumn{2}{l}{\textbf{
Robert Gruendl }
} \\\hline
\textbf{Test Cases} & \textbf{Assigned to} & \textbf{Executed by} & \textbf{Additional Test Personnel} \\ \hline
\href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1935}{LVV-T1935}
& {\small Robert Gruendl } & {\small Robert Gruendl } &
\begin{minipage}[]{6cm}
\smallskip
{\small  }
\medskip
\end{minipage}
\\ \hline
\href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1934}{LVV-T1934}
& {\small Robert Gruendl } & {\small Robert Gruendl } &
\begin{minipage}[]{6cm}
\smallskip
{\small  }
\medskip
\end{minipage}
\\ \hline
\end{longtable}
}

\newpage

\section{Test Campaign Overview}
\label{sect:overview}

\subsection{Summary}
\label{sect:summarytable}

{\small
\begin{longtable}{p{2cm}cp{2.3cm}p{8.6cm}p{2.3cm}}
\toprule
\multicolumn{2}{r}{ T. Plan \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P72}{LVV-P72}:} &
\multicolumn{2}{p{10.9cm}}{\textbf{ DM Acceptance Testing, Operations Rehearsal \#2 }} & Completed \\\hline
\multicolumn{2}{r}{ T. Cycle \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCycle/LVV-C159}{LVV-C159}:} &
\multicolumn{2}{p{10.9cm}}{\textbf{ LDM-503-11a: ComCam OPS Readiness }} & Done \\\hline
\textbf{Test Cases} &  \textbf{Ver.} & \textbf{Status} & \textbf{Comment} & \textbf{Issues} \\\toprule
\href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1935}{LVV-T1935}
&  1
\\
 \hfill Execution & LVV-E1125
& Pass &
\begin{minipage}[]{9cm}
\smallskip
Test script was executed by verifying that processing during OPS
Rehearsal 2 generated the expected calibrations and ingested same into
the calibration repository in the shared file area (currently
/project/shared/comCam/CALIB).
\medskip
\end{minipage}
&   \\\hline
\href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1934}{LVV-T1934}
&  1
\\
 \hfill Execution & LVV-E1124
& Pass &
\begin{minipage}[]{9cm}
\smallskip
Data transfer from ComCam (temporarily installed in the Base Data
Center) has been routinely performed since July 2020. ~ On the day this
test was executed (2020-10-28) the Data BackBone endpoint at NCSA was
checked for recently transferred data and then the shared repository was
checked to make sure that the data were ingested and made generally
available.
\medskip
\end{minipage}
&   \\\hline
\caption{Test Campaign Summary}
\label{table:summary}
\end{longtable}
}

\subsection{Overall Assessment}
\label{sect:overallassessment}

Not yet available.

\subsection{Recommended Improvements}
\label{sect:recommendations}

Not yet available.

\newpage
\section{Detailed Test Results}
\label{sect:detailedtestresults}

\subsection{Test Cycle LVV-C159 }

Open test cycle {\it \href{https://jira.lsstcorp.org/secure/Tests.jspa#/testrun/LVV-C159}{LDM-503-11a: ComCam OPS Readiness}} in Jira.

Test Cycle name: LDM-503-11a: ComCam OPS Readiness\\
Status: Done

Test that ComCam data can be received in the DBB, be made available and
processed with results also made available to DM staff.

\subsubsection{Software Version/Baseline}
lsst\_distrib ~w\_2020\_30

\subsubsection{Configuration}
ComCam operating at Base/Summit in a test stand capable of delivering
image to NCSA. ~Data Backbone endpoint and OODS (Observatory Operations
Data Service) ready to receive and ingest data.

\subsubsection{Test Cases in LVV-C159 Test Cycle}

\paragraph{ LVV-T1935 - Demonstrate ComCam Data Processing Capability }\mbox{}\\

Version \textbf{1}.
Status \textbf{Approved}.
Open  \href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1935}{\textit{ LVV-T1935 } }
test case in Jira.

To process raw ComCam data and demonstrate that the results are
available either in the shared DM development environment/repository or
in the RSP.

\textbf{ Preconditions}:\\
ComCam data acquisition and ingest are nominal. ~(LVV-T1934)

Execution status: {\bf  }

Final comment:\\



Detailed steps results LVV-C159-LVV-T1935 LVV-E1125-1505:\\
{\bf Note:} Steps "Not Executed" and with No Result are not shown in this report.\\
\begin{tabular}{p{4cm}p{12cm}}
\toprule
Step LVV-E1125-1 & Step Execution Status: \textbf{ Pass } \\ \hline
\end{tabular}
 Description \\
{\footnotesize
Obtain BIAS and FLAT sequences (minimum of 3 exposures each)

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Test Data \\
 {\footnotesize
Acquired from ComCam Archiver.

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Expected Result \\
{\footnotesize
Data acquired, ingested, and available in shared work space.

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Actual Result \\
{\footnotesize
During OPS rehearsal \#2 (see DMTN-159) bias and flat sequences were
acquired. ~Using the first night as an example:\\
\strut \\
cd /project/shared/comCam\\
sqlite3 \_parent/registry.sqlite3\\
select expId,dayObs,imageType,raftName,detectorName from raw where
dayObs=\textquotesingle2020-07-27\textquotesingle;\\
\strut \\
Shows sufficient BIAS and FLAT data have been properly ingested to the
shared work-space.

}
\begin{tabular}{p{4cm}p{12cm}}
\toprule
Step LVV-E1125-2 & Step Execution Status: \textbf{ Pass } \\ \hline
\end{tabular}
 Description \\
{\footnotesize
Process BIAS frames

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Test Data \\
 {\footnotesize
From Step 1

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Example Code \\
{\footnotesize
\begin{verbatim}
# setup a current LSST stack, currently:
/software/lsstsw/stack3/loadLSST.bash
setup -v lsst_distrib

setenv REPODIR=/project/shared/comCam
setenv VER_DIR={verification_dir}

constructBias.py $REPODIR --rerun $VER_DIR \
    --id expId=2020070800001^2020070800002^2020070800003 --batch-type none -c isr.doCrosstalk=False -j 9

ingestCalibs.py $REPODIR $REPODIR/rerun/$VER_DIR/bias/*/*.fits --validity 9999 --mode=link --calib $REPODIR/CALIB
\end{verbatim}

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Expected Result \\
{\footnotesize
Successful execution of BIAS reduction software (currently~

\begin{verbatim}
constructBias.py and ingestion)
\end{verbatim}

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Actual Result \\
{\footnotesize
The processing notes that accompany DMTN-159 (are available in the
github
repo~\href{https://github.com/lsst-dm/OPS_Rehearsal_2}{OPS\_Rehearsal\_2}).
There we find that constructBias.py and ingestCalibs.py were executed
and find in the calibration repo the associated ingested bias entries:\\
\strut \\
cd /project/shared/comCam\\
sqlite3 CALIB/calibRegistry.sqlite3\\
select * from bias where
calibDate=\textquotesingle2020-07-27\textquotesingle;\\
1\textbar NONE\textbar R22\textbar S00\textbar0\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
2\textbar NONE\textbar R22\textbar S01\textbar1\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
3\textbar NONE\textbar R22\textbar S02\textbar2\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
4\textbar NONE\textbar R22\textbar S10\textbar3\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
5\textbar NONE\textbar R22\textbar S11\textbar4\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
6\textbar NONE\textbar R22\textbar S12\textbar5\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
7\textbar NONE\textbar R22\textbar S20\textbar6\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
8\textbar NONE\textbar R22\textbar S21\textbar7\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
9\textbar NONE\textbar R22\textbar S22\textbar8\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28

}
\begin{tabular}{p{4cm}p{12cm}}
\toprule
Step LVV-E1125-3 & Step Execution Status: \textbf{ Pass } \\ \hline
\end{tabular}
 Description \\
{\footnotesize
Process FLAT frames

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Test Data \\
 {\footnotesize
From Step 1 (and step 2)

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Example Code \\
{\footnotesize
\begin{verbatim}
# setup a current LSST stack, currently:
/software/lsstsw/stack3/loadLSST.bash
setup -v lsst_distrib

setenv REPODIR=/project/shared/comCam
setenv VER_DIR={verification_dir}
\end{verbatim}

\begin{verbatim}
constructFlat.py $REPODIR --rerun $VER_DIR \
    --id expId=2020070100152..2020070100154 filter=r --batch-type none -j 9 -c isr.doCrosstalk=False
\end{verbatim}

\begin{verbatim}
ingestCalibs.py $REPODIR $REPODIR/rerun/$VER_DIR/flat/*/*.fits \
    --validity 9999 --mode=link --calib $REPODIR/CALIB
\end{verbatim}

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Expected Result \\
{\footnotesize
Successful execution of FLAT reduction software (currently
constructFlat.py and ingestion)

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Actual Result \\
{\footnotesize
Similar to step 2:\\
\strut \\
select * from flat where
calibDate=\textquotesingle2020-07-27\textquotesingle;\\
1\textbar r\textbar R22\textbar S00\textbar0\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
2\textbar r\textbar R22\textbar S01\textbar1\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
3\textbar r\textbar R22\textbar S02\textbar2\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
4\textbar r\textbar R22\textbar S10\textbar3\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
5\textbar r\textbar R22\textbar S11\textbar4\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
6\textbar r\textbar R22\textbar S12\textbar5\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
7\textbar r\textbar R22\textbar S20\textbar6\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
8\textbar r\textbar R22\textbar S21\textbar7\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28\\
9\textbar r\textbar R22\textbar S22\textbar8\textbar2020-07-27\textbar1993-03-12\textbar2020-07-28

}

\paragraph{ LVV-T1934 - ComCam Data Transfer and Ingestion }\mbox{}\\

Version \textbf{1}.
Status \textbf{Deprecated}.
Open  \href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1934}{\textit{ LVV-T1934 } }
test case in Jira.

Verify that ComCam Archiver data taken are transferred to NCSA Data
BackBone endpoint and Ingested

\textbf{ Preconditions}:\\
Operating ComCam and Base or Summit (test-stand or mounted on TMA)

Execution status: {\bf  }

Final comment:\\



Detailed steps results LVV-C159-LVV-T1934 LVV-E1124-1504:\\
{\bf Note:} Steps "Not Executed" and with No Result are not shown in this report.\\
\begin{tabular}{p{4cm}p{12cm}}
\toprule
Step LVV-E1124-1 & Step Execution Status: \textbf{ Pass } \\ \hline
\end{tabular}
 Description \\
{\footnotesize
Trigger Exposure through OCS+Archiver

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Test Data \\
 {\footnotesize
generated by ComCam as part of test

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Example Code \\
{\footnotesize
\hfill\break
\hfill\break

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Expected Result \\
{\footnotesize
Ingested ComCam exposure (9 files) at NCSA in shared Butler Repo (raw).
~

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Actual Result \\
{\footnotesize
Data are being routinely generate with ComCam installed at the Base Data
Center. ~ I have verified that new data were generated today
(2020-10-28) and transferred to NCSA and the DBB endpoint for raw data
exists and has data ~(i.e. files transfer has been placing new data in:
~/lsstdata/offline/teststand/comcam/Archiver/storage/2020-10-28 )

}
\begin{tabular}{p{4cm}p{12cm}}
\toprule
Step LVV-E1124-2 & Step Execution Status: \textbf{ Pass } \\ \hline
\end{tabular}
 Description \\
{\footnotesize
Check for presence of ingested raw data at NCSA

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Test Data \\
 {\footnotesize
Data produced in Step 1

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Example Code \\
{\footnotesize
\# note: currently assumes butler Gen2 (from NCSA machine)\\
cd /project/shared/comCam\\
sqlite3 \_parent/registry.sqlite3\\
select expId,dayObs,raftName,detectorName from raw where expId=\{expo
generated in step 1\};

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Expected Result \\
{\footnotesize
query of repo registry finds appropriate data entries showing a single
raft and 9 detectors

}
\hdashrule[0.5ex]{\textwidth}{1pt}{3mm}
  Actual Result \\
{\footnotesize
Following the example above the most recent raw exposure to have arrived
at NCSA had expId 2020102800060.\\
The following was generated when using that expId:\\
\strut \\
select expId,dayObs,raftName,detectorName from raw where
expId=2020102800060;\\
2020102800060\textbar2020-10-28\textbar R22\textbar S00\\
2020102800060\textbar2020-10-28\textbar R22\textbar S01\\
2020102800060\textbar2020-10-28\textbar R22\textbar S02\\
2020102800060\textbar2020-10-28\textbar R22\textbar S10\\
2020102800060\textbar2020-10-28\textbar R22\textbar S11\\
2020102800060\textbar2020-10-28\textbar R22\textbar S12\\
2020102800060\textbar2020-10-28\textbar R22\textbar S20\\
2020102800060\textbar2020-10-28\textbar R22\textbar S21\\
2020102800060\textbar2020-10-28\textbar R22\textbar S22\\
\strut \\
Confirming successful ingestion into the shared Gen2 repo at NCSA.

}



\input{appendix.tex}
\end{document}
